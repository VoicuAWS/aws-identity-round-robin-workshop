


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A hands-on workshop to learn about a variety of AWS identity topics.">
      
      
        <link rel="canonical" href="https://identity-round-robin.awssecworkshops.com/delegation/build/">
      
      
        <meta name="author" content="aws-security-workshops@amazon.com">
      
      <link rel="shortcut icon" href="../../assets/images/aws-favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.6">
    
    
      
        <title>Build Phase - Identity Round Robin</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.63b94e9e.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../stylesheets/custom.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#access-delegation-round-build-phase" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://identity-round-robin.awssecworkshops.com/" title="Identity Round Robin" class="md-header-nav__button md-logo" aria-label="Identity Round Robin">
      
  <img src="../../assets/images/aws_smile_logo.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Identity Round Robin
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Build Phase
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/aws-samples/aws-identity-round-robin-workshop/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws-samples/aws-identity-round-robin-workshop
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Overview
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../serverless/" class="md-tabs__link">
          Serverless Identity
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" class="md-tabs__link md-tabs__link--active">
          Access Delegation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../permission-boundaries-advanced/" class="md-tabs__link">
          Permissions Boundaries - Advanced
        </a>
      
    </li>
  

      
        
      
        
      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://identity-round-robin.awssecworkshops.com/" title="Identity Round Robin" class="md-nav__button md-logo" aria-label="Identity Round Robin">
      
  <img src="../../assets/images/aws_smile_logo.png" alt="logo">

    </a>
    Identity Round Robin
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/aws-samples/aws-identity-round-robin-workshop/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws-samples/aws-identity-round-robin-workshop
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Serverless Identity
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Serverless Identity" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Serverless Identity
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/" title="Scenario" class="md-nav__link">
      Scenario
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/task1/" title="Task 1" class="md-nav__link">
      Task 1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/task2/" title="Task 2" class="md-nav__link">
      Task 2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Access Delegation
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Access Delegation" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Access Delegation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Scenario" class="md-nav__link">
      Scenario
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Build Phase
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Build Phase" class="md-nav__link md-nav__link--active">
      Build Phase
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sign-in-to-aws" class="md-nav__link">
    Sign in to AWS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-macie" class="md-nav__link">
    Enable Macie
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-guardduty" class="md-nav__link">
    Enable GuardDuty
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-out-the-environment" class="md-nav__link">
    Build out the environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-roles" class="md-nav__link">
    Understanding Roles
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#switching-to-the-security-administrator-role" class="md-nav__link">
    Switching to the Security Administrator role
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refine-the-security-operator-role-permissions" class="md-nav__link">
    Refine the Security Operator role permissions
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../verify/" title="Verify Phase" class="md-nav__link">
      Verify Phase
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Permissions Boundaries - Advanced
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Permissions Boundaries - Advanced" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Permissions Boundaries - Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../permission-boundaries-advanced/" title="Scenario" class="md-nav__link">
      Scenario
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../permission-boundaries-advanced/build/" title="Build Phase" class="md-nav__link">
      Build Phase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../permission-boundaries-advanced/verify/" title="Verify Phase" class="md-nav__link">
      Verify Phase
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../contribute/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sign-in-to-aws" class="md-nav__link">
    Sign in to AWS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-macie" class="md-nav__link">
    Enable Macie
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-guardduty" class="md-nav__link">
    Enable GuardDuty
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-out-the-environment" class="md-nav__link">
    Build out the environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-roles" class="md-nav__link">
    Understanding Roles
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#switching-to-the-security-administrator-role" class="md-nav__link">
    Switching to the Security Administrator role
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refine-the-security-operator-role-permissions" class="md-nav__link">
    Refine the Security Operator role permissions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aws-samples/aws-identity-round-robin-workshop/edit/master/docs/delegation/build.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="access-delegation-round-build-phase">Access Delegation Round (Build Phase)</h1>
<table>
<thead>
<tr>
<th>IMPORTANT NOTE!</th>
</tr>
</thead>
<tbody>
<tr>
<td>Please make sure you have read the <strong><a href="../">scenario section</a></strong> before continuing below.</td>
</tr>
<tr>
<td>---</td>
</tr>
<tr>
<td>The AWS Console sometimes displays news and information about AWS features.  Feel free to close such windows to give you the maximum amount of free space on your screen..</td>
</tr>
<tr>
<td>Additionally, if you are sharing accounts as part of a team, each of you should take turns using the console because some of the services can only be used by one person at a time.</td>
</tr>
</tbody>
</table>
<h2 id="sign-in-to-aws">Sign in to AWS</h2>
<p>Depending on how you're doing this workshop, expand one of the following dropdowns to sign into AWS.</p>
<details class="info"><summary>Click here if you're at an <em>AWS event</em> where the <em>Event Engine</em> is being used</summary><p><p style="font-size:20px;">
  <strong>Step 1</strong> : Retrieve temporary credentials from Event Engine
</p></p>
<ol>
<li>Navigate to the <a href="https://dashboard.eventengine.run" target="_blank">Event Engine dashboard</a></li>
<li>Enter your <strong>team hash</strong> code. </li>
<li>Click <strong>AWS Console</strong></li>
<li>Copy the <strong>export</strong> commands under the <strong>Credentials</strong> section for the temporary credentials (you will need these in the next step.)</li>
<li>Click <strong>Open Console</strong> from the Event Engine window</li>
</ol>
</details>
<details class="info"><summary>Click here if you're at an AWS-sponsored event and AWS provided an account to you</summary><ol>
<li>
<p>In a separate tab in your web browser, go to the URL provided to you and login. </p>
</li>
<li>
<p>After you login click the <strong>AWS Account</strong> box, then click on the Account ID displayed below that (the red box in the image.) You should see a link below that for the <strong>Management console</strong>. Click on that and you will be taken to the AWS console. </p>
</li>
</ol>
<p><img alt="login-page" src="../images/login.png" /></p>
</details>
<details class="info"><summary>Click here if you are using your own AWS account (whether you are at an AWS event, a separate event or online)</summary><p>In a separate tab in your web browser, go to https://aws.amazon.com/console and log into your account.</p>
</details>
<h2 id="enable-macie">Enable Macie</h2>
<ol>
<li>
<p>You will need Macie for this lab so you must make sure Amazon Macie is running.
Select <strong>Macie</strong> from the main console.
Macie will open in a new browser tab.</p>
</li>
<li>
<p>Select the us-east-1 (N. Virginia) region in the Macie console.</p>
</li>
<li>
<p>When the Macie console appears, if a <strong>Getting Started</strong> button appears, it means that Amazon Macie is disabled.
In that case, click <strong>Getting Started</strong>, confirm that US East (N. Virginia) is selected as the region, and click <strong>Enable Macie</strong>.
This may take from several seconds to complete.
The Macie console will appear after Macie has been enabled.
Close the browser tab containing the Macie console.</p>
</li>
</ol>
<h2 id="enable-guardduty">Enable GuardDuty</h2>
<ol>
<li>
<p>You will also need GuardDuty for this lab so you will now enable GuardDuty.</p>
</li>
<li>
<p>Return to the AWS Console, signing into the account again if necessary. Select <strong>GuardDuty</strong> from the main console.  </p>
</li>
<li>
<p>If you see a <strong>Get Started</strong> button, click it.</p>
</li>
<li>
<p>If the region is not set to Northern Virginia, select Northern Virginia (or N. Virginia) for the region.</p>
</li>
<li>
<p>Click <strong>Enable GuardDuty</strong>.</p>
</li>
</ol>
<h2 id="build-out-the-environment">Build out the environment</h2>
<blockquote>
<p>*<em>NOTE</em>:  The instructions that follow are based on the classic version of the CloudFormation console.  CloudFormation also offers a redesigned console that offers a different overall look and feel.  You are welcome to use the redesigned CloudFormation console.  If you choose to do so, you will notice some minor differences from the instructions below.</p>
</blockquote>
<ol>
<li>
<p>Open the <strong>Deploy to AWS</strong> link that follows in a <strong>new browser</strong> tab to deploy the logging environment in the us-east-1 region:  <a href="https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/new?stackName=esslab&amp;templateURL=https://s3.amazonaws.com/sa-security-specialist-workshops-us-east-1/identity-workshop/essround/EssInitAccount.yaml"><img alt="Deploy IamEssInitAccount.yaml in us-east-1" src="../images/deploy-to-aws.png" /></a></p>
</li>
<li>
<p>In the new browser tab that you just opened, you will see the Select Template page.  Click <strong>Next</strong>.</p>
</li>
<li>
<p>On the Specify Details/Parameters page, the values have been filled in for you.  Click <strong>Next</strong>.</p>
</li>
<li>
<p>On the Options page, click <strong>Next</strong>.</p>
</li>
<li>
<p>On the Review page, check the <strong>I acknowledge</strong> box and click <strong>Create</strong>.
The acknowledgement is requested because of the creation of resources with custom names.
The CloudFormation template does this when it creates certain resources with names that make it easier to identify them.</p>
<p>CloudFormation will now begin to create the resources.
<strong>Refresh the entire browser window to view the progress.</strong>
This takes about five minutes.
Wait until the Status value for the <strong>esslab</strong> stack shows <strong>CREATE_COMPLETE</strong>.
You can refresh the browser window to update the status.</p>
</li>
<li>
<p>Take a look at the outputs for the <strong>esslab</strong> CloudFormation stack.  They will look similar to the picture below.  You may need to drag the horizontal dividing line upwards to see all the output values.</p>
<p><img alt="Account output" src="../images/IamEssOutputStack.png" /></p>
<p>The output value assigned to <em>LoggingBucketName</em>  is the name of the bucket into which AWS CloudTrail will deliver its logs.  Copy the value of <em>LoggingBucketName</em> to a scratch file on your workstation so you have it available later.</p>
<p>The value assigned to <em>SecAdministratorRoleURL</em> is a URL that you will use later in the lab to temporarily "switch to" (meaning take on the access privileges of) a Security Administrator role.   This role has full administrative privileges for AWS CloudTrail, Amazon GuardDuty, Amazon Inspector, and Amazon Macie.</p>
<p>The value assigned to <em>SecOperatorRoleURL</em> is a URL that you will use later in the lab to temporarily "switch to" a Security Operator role.   You will later modify the policy associated with this role so it only has "read only" privileges for AWS CloudTrail, Amazon GuardDuty, Amazon Inspector, and Amazon Macie.</p>
</li>
<li>
<p>Let's take a look at CloudTrail logging.  The most important part of collecting AWS CloudTrail information into an Amazon S3 bucket is setting the correct permissions on the Amazon S3 bucket.</p>
<p>Go to the S3 console, click on the name assigned to <em>LoggingBucketName</em> which you note in Step 6, click on the  <strong>Permissions</strong> tab, and then scroll down to <strong>Bucket Policy</strong>.  Note that the policy allows the CloudTrail service to read the ACL of the <em>LoggingBucket</em> and also to create logs with prefixes containing the AWS account ID. you can read more about this policy at this <a href="https://docs.aws.amazon.com/awscloudtrail/latest/userguide/create-s3-bucket-policy-for-cloudtrail.html">link</a>.</p>
</li>
<li>
<p>Click the <strong>AWSLogs</strong> folder prefix.
You should then see the AWS account ID of your account as shown below.</p>
<p><img alt="LoggingBucket" src="../images/IamEssBucket.png" /></p>
<p>This shows that AWS CloudTrail logs for your account have started to make their way to the S3 bucket.
It may take up to five minutes for logs to start appearing.  You can go further into the directory by year, month, and day to see logs as they appear.   The logs are stored in ".gz" (gzip) format.  If you have an archive management tool and you see one of these log files, feel free to download it to your workstation and expand the archive.  Again, it may take several minutes for the logs to begin to appear.</p>
</li>
</ol>
<h2 id="understanding-roles">Understanding Roles</h2>
<p>A role is a security principal, an actor, that has a set of policies and a trust relationship.  A user, an application, or an AWS service can <em>assume</em> the role in order to substitute its own access privileges for those associated with the role.  The <em>policies</em> define what AWS actions the role can perform.  The <em>trust relationship</em> defines who is allowed to assume the role.</p>
<p>The CloudFormation stack you just built created two roles. One role is for a Security Administrator who has full access to CloudTrail, GuardDuty, Inspector, and Macie.  The other role is for a Security Operator who, after changes you make later on, will have read-only access to these services.  You are going to switch to the Security Administrator role but before doing so, let's look at the privileges associated with that role so you can see what it does.</p>
<ol>
<li>
<p>Go to the IAM console, select <strong>Roles</strong> on the left and search for the string <em>SecAdministrator</em>.  You can search either by using your browser's search capability or you can type <em>SecAdministrator</em> into the search box.  Click on the role that you retrieve.
The policy definition will be similar to the image below.</p>
<p><img alt="SecAdministratorRolePolicy" src="../images/IamEssSecAdminPolicy.png" /></p>
<p>You may need to click <strong>Show more</strong> to see all of the policies.  There are six managed policies attached to this role, five of them are provided by AWS for GuardDuty, Inspector, CloudTrail, IAM, and SNS.  While you will not be working directly with SNS and IAM, the policies for SNS and IAM are included because including them provides for a better console experience.  There is a sixth managed policy that was created for Amazon Macie to illustrate how custom managed policies can be developed. Edit this policy so it says <code>macie2:*</code>. Click on each of the managed policies to see the underlying privileges of each.  Note that there are some services, such as Amazon EFS (Elastic File System), that are not granted by any of these policies.  You will confirm this lack of access later in this workshop.</p>
</li>
<li>
<p>From the main page of the role, click the <strong>Trust relationships</strong> tab.  You will see a section on the page telling you that the trusted entity (the entity that can assume the role) is the 12-digit AWS account ID as shown below.  This means that any principal in the account can assume the role.</p>
<p><img alt="SecAdministratorTrustRel" src="../images/IamEssAdminTrustRel.png" /></p>
</li>
<li>
<p>The internal representation of the trust relationship is a JSON policy document.  Click <strong>Show policy document</strong>.  You will see a policy similar to that shown in the picture below.</p>
<p><img alt="SecAdministratorTrustRel" src="../images/IamEssAdminTrustPol.png" /></p>
<p>In the principal entry, you will see a value that ends in ":root."  This is a special <em>principal identifier</em> that refers to the account itself.  This policy says that every principal in the account (users, roles, etc.) is allowed to use the sts:AssumeRole action to take on the identity of the role.  You can read more about principal identifiers <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_identifiers.html">here</a>.</p>
<p>STS stands for <em>Security Token Service</em>.  The AssumeRole API associated with the service creates temporary credentials when you call the API that are associated with the security policies of the role including an access key and a secret access key.  Your application then uses these security tokens to make calls to other AWS APIs with the policies defined in the role.</p>
</li>
</ol>
<h2 id="switching-to-the-security-administrator-role">Switching to the Security Administrator role</h2>
<p>You are now going to learn about how to switch to a new role in the AWS console.
Switching to a new role allows you to temporarily <em>substitute</em> your AWS console permissions for those contained in another role.
In this lab, you will be switching to roles that are in your own AWS account.
You can also switch to roles in other AWS accounts to gain access to resources in accounts other than your own.
This is known as <em>cross-account access</em>.
You will not be doing <em>cross-account access</em> in this lab.</p>
<p>There are two ways you can switch roles.  You can use the Switch Role command that's available as a drop down from the console under your account name.  Alternatively, you can use a URL that does the switching for you.  You will use both methods below.</p>
<ol>
<li>
<p>Go to the CloudFormation console and view the outputs tab of the CloudFormation stack named <em>esslab</em> you just built.</p>
</li>
<li>
<p>Click on the URL next to <em>SecAdministratorRoleURL</em>.  You may need to scroll down to see it.
A new browser tab window will appear showing information similar to the image below.</p>
<p><img alt="SecAdministratorRole" src="../images/IamEssSwitchSecAdminRole.png" /></p>
<p>The box contains the account ID (which is the ID of your AWS account), a role name that was created by CloudFormation, and a Display Name.
You can also select a color that will be used to display the role you assume in the console.</p>
<p>Click <strong>Switch Role</strong>.</p>
<p>You will now see a new role label named <em>SecAdministrator</em> in the top of your console window as shown below.</p>
<p><img alt="SecAdministratorLabel" src="../images/IamEssSwitchSecAdminRolePost.png" /></p>
<p>This means that your <em>effective</em> privileges have been <em>temporarily</em> replaced with those of the SecAdministrator role.</p>
</li>
<li>
<p>Go to the Amazon EFS console.  Notice that you get a message telling you that you do not have access to any of the features of the console.  This is because none of the underlying policies grant any access to any part of Amazon EFS.</p>
<p><img alt="EFSConsole" src="../images/IamEssEFSConsole.png" /></p>
</li>
<li>
<p>Now go to the Amazon Inspector Console.  To verify that you have administrative capabilities for Inspector, you are going to clone an existing template.  Click <strong>Assessment Templates</strong> and check the box to the left of the template name that begins with <em>LampInspectorAssessmentTemplate</em> and click <strong>Clone</strong>.  A section of the form will appear.  Scroll down towards the bottom and click the <strong>Create</strong> button.   Refresh the screen.  You should now see two templates that begin with <em>LampInspectorAssessment</em>.  If you widen the Name column you will see that the newly created template contains the string "Cloned."  You have just successfully cloned an assessment template which shows that you have administrative access privileges for Inspector.</p>
</li>
<li>
<p>Now go to the GuardDuty console and select the Settings menu item.  To verify that you do have administrative capabilities for GuardDuty, scroll down to the field named <em>Findings export options</em> and change the <em>Frequency for updated findings</em> value to <strong>Update CWE and S3 every 1 hour</strong> and click <strong>Save</strong>.
You will see a message at the top of your window (you may need to scroll up) saying that the settings have been saved. This shows you do have full access to <em>GuardDuty</em>.</p>
</li>
<li>
<p>Go to the Macie console, make sure you are in the US East (N. Virginia) region, click Settings, scroll down and click the <strong>Suspend Macie</strong> button. Confirm you want to suspend Macie by typing <em>Suspend</em> in the text box when prompted. Click ok. This shows that you have administrative access to Macie.</p>
</li>
<li>
<p>Navigate to the CloudTrail console.</p>
</li>
<li>
<p>Click <strong>Trails</strong> and then click the trail whose name begins with <em>esslab</em>.</p>
</li>
<li>
<p>Click the <strong>Stop logging</strong> button on the top right and select <strong>Stop logging</strong> in the pop up window. Now toggle logging back on by clicking <strong>Start logging</strong> on the top right. This shows that you have administrative access to CloudTrail.</p>
</li>
<li>
<p>Now that you have confirmed that you have administrative access to Inspector, Macie, GuardDuty, and CloudTrail, you no longer need your temporary permissions.
Click on the SecAdministrator label and select <strong>Back to</strong> on the bottom right of the menu as shown below.  Also note that the console maintains a role history to make it easier for you to switch back to the SecAdministrator role later.</p>
<p><img alt="SwitchBacktoAdmin" src="../images/IamSwitchFromSecAdmin.png" /></p>
<p>After you switch back to your regular role the special role label for SecAdministrator is no longer displayed.</p>
</li>
</ol>
<h2 id="refine-the-security-operator-role-permissions">Refine the Security Operator role permissions</h2>
<p>Now that you know how to switch to the Security Administrator role, you are going to make some changes to the permissions for the Security Operator role so that it only has read-only access to Macie, GuardDuty, Inspector, and CloudTrail.</p>
<ol>
<li>
<p>Go to the IAM console, select <strong>Roles</strong> and search for <em>SecOperator</em>.
Click on the resulting role that you see.
The role will have permissions similar to those shown in the picture below.</p>
<p><img alt="SecOperPolicy" src="../images/IamEssSecOperPolicy.png" /></p>
</li>
<li>
<p>Notice that there are once again managed policies, five AWS-managed policies for Inspector, GuardDuty, CloudTrail, IAM, and SNS, and a custom managed policy for Macie.
The managed policies for Inspector, GuardDuty, and CloudTrail still provide full access to the services.
The Macie policy (whose name contains <em>SecOperatorMaciePolicy</em>), despite its name, still provides full access to Macie. There are also SNS and IAM policies to provide for a better console experience.</p>
</li>
<li>
<p>Remove the AmazonCloudTrailFullAccess, AmazonGuardDutyFullAccess, and Amazon InspectorFullAccess policies by clicking on the removal crosses as shown by the arrows.
Add read-only access policies for Inspector, CloudTrail, and GuardDuty. You will also need list access for Inspector, Guard Duty and Macie so that the AWS console can display the service pages correctly. Remember to modify the Macie policy for read and list only.</p>
<p>If you need some hints, open the dropdown below.</p>
<p><details>
<summary><strong>Click here to expand</strong></summary><p>
<br/></p>
<p>Here are some links that offer information that may be helpful to you.  Open them in a <em>new</em> browser tab for more information.</p>
<p><a href="https://docs.aws.amazon.com/awscloudtrail/latest/userguide/control-user-permissions-for-cloudtrail.html">Controlling access to Amazon CloudTrail</a></p>
<p><a href="https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_managing_access.html">Controlling access to Amazon GuardDuty</a></p>
<p><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/list_amazoninspector.html">Controlling access to Amazon Inspector</a></p>
<p><a href="https://docs.aws.amazon.com/macie/latest/userguide/macie-access-control.html">Controlling access to Amazon Macie</a></p>
</details>

</li>
<li>
<p>Go to the CloudFormation console and view the outputs tab of the CloudFormation stack named <em>esslab</em> you built earlier.</p>
</li>
<li>
<p>Click on the URL next to SecOperatorRoleURL.
A new browser tab window will appear showing information similar to the image below.</p>
<p><img alt="SecOperatorRole" src="../images/IamEssSwitchSecOperRole.png" /></p>
<p>The box contains the account ID (which is the ID of your AWS account), a role name that was created by CloudFormation, and a Display Name.
You can also select a color that will be used to display the role you assume in the console.</p>
<p>Click <strong>Switch Role</strong>.</p>
<p>You will now see a new role label named <em>SecAdministrator</em> in the top of your console window as shown below.</p>
<p><img alt="SecOperatorLabel" src="../images/IamEssSwitchSecOperRolePost.png" /></p>
<p>This means that your <em>effective</em> privileges have been <em>temporarily</em>  replaced with those of the SecOperator role.</p>
</li>
<li>
<p>Now go to the Amazon Inspector Console.  Click <strong>Assessment Templates</strong> and check the box to the left of both of the template names that begin with <em>LampInspectorAssessmentTemplate</em> and click <strong>Delete</strong>.  You will be asked to confirm the deletion.  Click <strong>Yes</strong>.  After 30 or so seconds you will see an error message telling you that you are not authorized to call the inspector:DeleteAssessmentTemplate action.  This is because you have read-only access to Inspector.</p>
</li>
<li>
<p>Now go to the GuardDuty console, click <strong>Settings</strong>, change the <em>Frequency for updated findings</em> field to a different value, and click <strong>Save</strong>.  You will see an error message telling you that you are not authorized to perform the action.  You may need to scroll up to see it. Once you refresh the browser, you can see that the frequency didn't change. This is because you have read-only access to GuardDuty.</p>
</li>
<li>
<p>Go to the Macie console, make sure you are in the US East (N. Virginia) region, click Settings, Ignore the Error at the top. Scroll down and click the <strong>Re-enable Macie</strong> button. You will receive an error message regarding this action because you have read-only access to Macie.</p>
</li>
<li>
<p>Navigate to the CloudTrail console.</p>
</li>
<li>
<p>Click <strong>Trails</strong> and click the trail whose name begins with <em>esslab</em>.</p>
</li>
<li>
<p>Click the <strong>Stop logging</strong> button on the top right and select <strong>Stop logging</strong> in the pop up window.  You will receive an error message because you have read-only access to CloudTrail.</p>
</li>
<li>
<p>Now switch back to your default role.
After this the SecOperator role label will no longer appear on your console.</p>
</li>
<li>
<p>If you doing this workshop as part of a team <strong>and</strong> you have some time, exchange your account credentials with those of another team and click <a href="../verify/">here</a> to proceed to the Verify Phase and begin <strong>at the top.</strong></p>
<p>Otherwise, proceed to the <a href="../verify/">Verify Phase</a> and go to the <strong>Clean Up section towards the bottom</strong>.</p>
</li>
</ol>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../" title="Scenario" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Scenario
              </div>
            </div>
          </a>
        
        
          <a href="../verify/" title="Verify Phase" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Verify Phase
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            <a href="https://aws.amazon.com/privacy/" target="_blank">Privacy</a> | <a href="https://aws.amazon.com/terms/" target="_blank">Site terms</a> | &copy; 2020, Amazon Web Services, Inc. or its affiliates. All rights reserved.
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://awssecworkshops.com" target="_blank" rel="noopener" title="awssecworkshops.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M280.37 148.26L96 300.11V464a16 16 0 0016 16l112.06-.29a16 16 0 0015.92-16V368a16 16 0 0116-16h64a16 16 0 0116 16v95.64a16 16 0 0016 16.05L464 480a16 16 0 0016-16V300L295.67 148.26a12.19 12.19 0 00-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 00-12-12h-56a12 12 0 00-12 12v72.61L318.47 43a48 48 0 00-61 0L4.34 251.47a12 12 0 00-1.6 16.9l25.5 31A12 12 0 0045.15 301l235.22-193.74a12.19 12.19 0 0115.3 0L530.9 301a12 12 0 0016.9-1.6l25.5-31a12 12 0 00-1.7-16.93z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://aws.amazon.com/security/" target="_blank" rel="noopener" title="aws.amazon.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M466.5 83.7l-192-80a48.15 48.15 0 00-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/awssecurityinfo?lang=en" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://aws.amazon.com/blogs/security/" target="_blank" rel="noopener" title="aws.amazon.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M400 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM112 416c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm157.533 0h-34.335c-6.011 0-11.051-4.636-11.442-10.634-5.214-80.05-69.243-143.92-149.123-149.123-5.997-.39-10.633-5.431-10.633-11.441v-34.335c0-6.535 5.468-11.777 11.994-11.425 110.546 5.974 198.997 94.536 204.964 204.964.352 6.526-4.89 11.994-11.425 11.994zm103.027 0h-34.334c-6.161 0-11.175-4.882-11.427-11.038-5.598-136.535-115.204-246.161-251.76-251.76C68.882 152.949 64 147.935 64 141.774V107.44c0-6.454 5.338-11.664 11.787-11.432 167.83 6.025 302.21 141.191 308.205 308.205.232 6.449-4.978 11.787-11.432 11.787z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d1f5a259.min.js"></script>
      <script src="../../assets/javascripts/bundle.d5fec882.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.fae956e7.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>